PROJECT: BLOX-TAK-CoT
VERSION: v0.0.0.1
DATE:    2026-01-31_15-02-20
============================================================

NOTE: Full codebase dump excluding secrets (certs/) and environments.
UWAGA: Pe≈Çny zrzut kodu ≈∫r√≥d≈Çowego z pominiƒôciem sekret√≥w (certs/) i ≈õrodowisk.
============================================================

FILE MANIFEST / LISTA PLIK√ìW:
------------------------------
.gitignore
LICENSE.txt
N2YO-API-Query_PyCoT-TAK-Server.py
README.md
cot.log
cot_replay.log
replay_cot.py
requirements.txt

============================================================


--- START FILE: .gitignore ---
# --- SECURITY (CRITICAL) ---
certs/
*.key
*.pem
*.p12
*.crt

# --- LOGS ---
# Ignoruj wszystkie logi...
*.log

# ...ALE te konkretne zachowaj jako dane treningowe dla u≈ºytkownika!
!cot.log

# --- PYTHON & ENVIRONMENT ---
.venv/
venv/
ENV/
__pycache__/
*.pyc

# --- IDE / SYSTEM ---
.idea/
.vscode/
.DS_Store
--- END FILE: .gitignore ---

--- START FILE: LICENSE.txt ---
MIT License

Copyright (c) 2026 ≈Åukasz "LukeStriderGM" Andruszkiewicz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
--- END FILE: LICENSE.txt ---

--- START FILE: N2YO-API-Query_PyCoT-TAK-Server.py ---
import CoT  # https://pypi.org/project/PyCoT
import requests
import datetime
import socket
import ssl
import time
import os
import logging
import warnings

# --- CONFIGURATION OF WARNINGS ---
# --- KONFIGURACJA OSTRZE≈ªE≈É ---

# Disable annoying library warnings about date format for cleaner logs
# Wy≈ÇƒÖcz irytujƒÖce ostrze≈ºenia biblioteki o formacie daty dla czystszych log√≥w
warnings.filterwarnings("ignore")

# --- LOGGING CONFIGURATION ---
# --- KONFIGURACJA LOGOWANIA ---

# Configure file logging
# Konfiguracja logowania do pliku
logging.basicConfig(
    filename="/home/lukestridergm/BLOX-TAK-CoT/cot.log",
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s"
)

# --- USER SETTINGS ---
# --- USTAWIENIA U≈ªYTKOWNIKA ---

# API Key and Target Satellite ID (ZQ-3 R/B)
# Klucz API i ID docelowego satelity (ZQ-3 R/B)
N2YO_API_KEY = "*****"
SAT_ID = 66877

# Observer coordinates (Your Location)
# Koordynaty obserwatora (Twoja Lokalizacja)
OBSERVER_LAT = 50.81557
OBSERVER_LNG = 15.675225
OBSERVER_ALT = 445

# Prediction settings
# Ustawienia predykcji
SECONDS = 1
REFRESH_INTERVAL = 10

# --- TAK SERVER SETTINGS ---
# --- USTAWIENIA SERWERA TAK ---

# IP address and port
# Adres IP i port
TAK_IP = "192.168.1.2"
TAK_PORT = 8089

# --- SSL CERTIFICATES ---
# --- CERTYFIKATY SSL ---

# Define paths to certificates
# Zdefiniuj ≈õcie≈ºki do certyfikat√≥w
CERT_DIR = "/home/lukestridergm/BLOX-TAK-CoT/certs"
CLIENT_CERT = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN.pem")
CLIENT_KEY = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN.key")
CA_CERT = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN-trusted.pem")

# --- SSL CONTEXT PREPARATION ---
# --- PRZYGOTOWANIE KONTEKSTU SSL ---

# Load client and CA certificates for secure connection
# Za≈Çaduj certyfikaty klienta i CA dla bezpiecznego po≈ÇƒÖczenia
ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
ssl_context.load_cert_chain(certfile=CLIENT_CERT, keyfile=CLIENT_KEY)
ssl_context.load_verify_locations(cafile=CA_CERT)
ssl_context.verify_mode = ssl.CERT_REQUIRED

# Print startup information
# Wypisz informacje startowe
print(f"üöÄ STARTING TRACKING: {SAT_ID}")
print(f"üöÄ ROZPOCZYNAM ≈öLEDZENIE: {SAT_ID}")

print(f"üéØ TARGET: {TAK_IP}:{TAK_PORT} (SSL)")
print(f"üéØ CEL: {TAK_IP}:{TAK_PORT} (SSL)")

print(f"‚ö†Ô∏è MODE: HOSTILE (IMMINENT IMPACT)")
print(f"‚ö†Ô∏è TRYB: WROGI (NADCHODZƒÑCE UDERZENIE)")
print("-" * 40)

# --- MAIN LOOP ---
# --- G≈Å√ìWNA PƒòTLA ---

while True:
    try:
        # 1. Fetch data from N2YO
        # 1. Pobierz dane z N2YO

        # Measure query start time
        # Zmierz czas rozpoczƒôcia zapytania
        start_time = time.time()
        url = f"https://api.n2yo.com/rest/v1/satellite/positions/{SAT_ID}/{OBSERVER_LAT}/{OBSERVER_LNG}/{OBSERVER_ALT}/{SECONDS}/&apiKey={N2YO_API_KEY}"

        try:
            # Send GET request with timeout
            # Wy≈õlij ≈ºƒÖdanie GET z timeoutem
            response = requests.get(url, timeout=10)
        except requests.RequestException as e:
            # Handle connection error
            # Obs≈Çu≈º b≈ÇƒÖd po≈ÇƒÖczenia
            print(f"‚ùå N2YO Connection Error: {e}")
            print(f"‚ùå B≈ÇƒÖd po≈ÇƒÖczenia z N2YO: {e}")
            time.sleep(30)
            continue

        # Check API response status
        # Sprawd≈∫ status odpowiedzi API
        if response.status_code != 200:
            print(f"‚ùå N2YO API Error: {response.status_code}")
            print(f"‚ùå B≈ÇƒÖd API N2YO: {response.status_code}")
            time.sleep(60)
            continue

        # Parse JSON data
        # Parsuj dane JSON
        data = response.json()
        positions = data.get("positions", [])

        # Check if positions are available
        # Sprawd≈∫, czy pozycje sƒÖ dostƒôpne
        if not positions:
            print(f"‚ö†Ô∏è No position data (Satellite below horizon or error).")
            print(f"‚ö†Ô∏è Brak danych o pozycji (Satelita pod horyzontem lub b≈ÇƒÖd).")
            time.sleep(30)
            continue

        # Get satellite name
        # Pobierz nazwƒô satelity
        sat_name = data["info"]["satname"]

        # 2. Connect to TAK Server
        # 2. Po≈ÇƒÖcz z serwerem TAK

        # Initialize socket with SSL wrapper
        # Inicjalizuj gniazdo z opakowaniem SSL
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        wrapped_sock = ssl_context.wrap_socket(sock, server_hostname=TAK_IP)
        wrapped_sock.settimeout(5.0)

        try:
            # Establish connection
            # NawiƒÖ≈º po≈ÇƒÖczenie
            wrapped_sock.connect((TAK_IP, TAK_PORT))
        except Exception as e:
            # Handle TAK connection failure
            # Obs≈Çu≈º b≈ÇƒÖd po≈ÇƒÖczenia z TAK
            print(f"‚ùå Cannot connect to TAK Server: {e}")
            print(f"‚ùå Nie mo≈ºna po≈ÇƒÖczyƒá z TAK Server: {e}")
            time.sleep(5)
            continue

        # 3. Generate and Send CoT
        # 3. Generuj i wy≈õlij CoT

        for sat_data in positions:
            # Extract coordinates
            # WyciƒÖgnij koordynaty
            sat_lat = sat_data["satlatitude"]
            sat_lon = sat_data["satlongitude"]

            # Convert altitude from km to meters (Critical for ATAK)
            # Konwertuj wysoko≈õƒá z km na metry (Kluczowe dla ATAK)
            sat_alt_m = sat_data["sataltitude"] * 1000

            # Set timestamps (UTC)
            # Ustaw znaczniki czasu (UTC)
            now = datetime.datetime.now(datetime.timezone.utc)
            stale = now + datetime.timedelta(minutes=2)

            # Build CoT Event object
            # Zbuduj obiekt zdarzenia CoT

            # CoT types: https://github.com/wcrum/py-cot/blob/main/CoT/types.py
            cot_event = CoT.Event(
                version="2.0",
                type="a-h-P-S",  # Hostile Space Satellite
                uid=f"SAT-{SAT_ID}",
                time=now,
                start=now,
                stale=stale,
                how="m-g",
                point=CoT.Point(
                    lat=sat_lat,
                    lon=sat_lon,
                    hae=sat_alt_m,
                    ce=1000,
                    le=1000
                ),
                detail={
                    "contact": {"callsign": f"{sat_name} (DECAY)"},
                    "remarks": f"ALT: {sat_alt_m / 1000:.1f}km. UNCONTROLLED REENTRY via N2YO.",
                    "track": {"speed": 7800, "course": 0},
                    "status": {"readiness": "true"}
                }
            )

            # Convert to XML and send
            # Konwertuj na XML i wy≈õlij
            xml_data = cot_event.xml()
            wrapped_sock.sendall(bytes(xml_data, encoding="utf-8"))

            # Log to console with FIXED ALIGNMENT
            # Loguj do konsoli ze STA≈ÅYM WYR√ìWNANIEM
            # (>8.0f means: align right, 8 chars total width, 0 decimals)
            # (>7.2f means: align right, 7 chars total width, 2 decimals)
            print(
                f"üì° SENT: {now.strftime('%H:%M:%S')} | ALT: {sat_alt_m:>8.0f} m | LAT: {sat_lat:>7.2f} | LON: {sat_lon:>8.2f} | üî¥ HOSTILE")
            print(
                f"üì° WYS≈Å: {now.strftime('%H:%M:%S')} | WYS: {sat_alt_m:>8.0f} m | SZER:{sat_lat:>7.2f} | D≈ÅU: {sat_lon:>8.2f} | üî¥ WROGI")

            # Log to file (CORRECTED LINE - THIS IS THE FIX)
            # Loguj do pliku (POPRAWIONA LINIA - TO JEST POPRAWKA)
            logging.info(f"CoT for {sat_name}: lat={sat_lat}, lon={sat_lon}, alt={sat_alt_m}")

            # Clear buffer (Receive confirmation)
            # Wyczy≈õƒá bufor (Odbierz potwierdzenie)
            try:
                _ = wrapped_sock.recv(1024)
            except socket.timeout:
                pass

        # Close connection and wait
        # Zamknij po≈ÇƒÖczenie i czekaj
        wrapped_sock.close()
        time.sleep(REFRESH_INTERVAL)

    except KeyboardInterrupt:
        # Handle manual stop
        # Obs≈Çu≈º rƒôczne zatrzymanie
        print(f"\nüî¥ Stopped manually.")
        print(f"\nüî¥ Zatrzymano rƒôcznie.")
        break
    except Exception as e:
        # Handle critical loop error
        # Obs≈Çu≈º krytyczny b≈ÇƒÖd pƒôtli
        print(f"\n‚ùå Critical Loop Error: {e}")
        print(f"\n‚ùå B≈ÇƒÖd krytyczny pƒôtli: {e}")
        logging.error(f"Critical Loop Error: {e}")
        time.sleep(10)
--- END FILE: N2YO-API-Query_PyCoT-TAK-Server.py ---

--- START FILE: README.md ---
# üá∫üá∏ BLOX-TAK-CoT

Welcome to **BLOX-TAK-CoT**. This project is a universal, Python-based integration bridge designed to track **any** orbital object (Satellites, Rocket Bodies, Debris, Space Stations) in real-time via the N2YO API and visualize its telemetry within the ATAK (Android Team Awareness Kit) ecosystem using the Cursor on Target (CoT) protocol.

While initially developed to research "Ghost Satellite" phenomena during uncontrolled reentries (like ZQ-3), **BLOX-TAK-CoT** is fully configurable to track stable assets (ISS, Starlink, Tiangong) or high-value targets by simply changing the configuration ID.

üì∫ #YouTube:

CORE - https://youtu.be/lcWTPbxM3_g

REPLAY - https://youtu.be/nNv6e3a4rn4

üåê Socials:

Linkedin: https://www.linkedin.com/posts/lukebluelox_zq3-reentry-blox-share-7423271365610393600-aTHS

ùïè: https://x.com/LukeStriderGM/status/2017505686943314412

<details>

<summary>üáµüá± [Kliknij Tr√≥jkƒÖt Po Lewej Stronie Aby RozwinƒÖƒá Opis w Jƒôzyku Polskim]</summary>

# üáµüá± BLOX-TAK-CoT

Witaj w **BLOX-TAK-CoT**. Ten projekt to uniwersalny most integracyjny oparty na jƒôzyku Python, zaprojektowany do ≈õledzenia **dowolnego** obiektu orbitalnego (satelity, cz≈Çony rakiet, ≈õmieci kosmiczne, stacje kosmiczne) w czasie rzeczywistym za po≈õrednictwem API N2YO i wizualizacji jego telemetrii w ekosystemie ATAK (Android Team Awareness Kit) przy u≈ºyciu protoko≈Çu Cursor on Target (CoT).

Choƒá narzƒôdzie to zosta≈Ço pierwotnie opracowane do badania zjawisk "Satelit√≥w Duch√≥w" podczas niekontrolowanych wej≈õƒá w atmosferƒô (jak ZQ-3), **BLOX-TAK-CoT** jest w pe≈Çni konfigurowalne do ≈õledzenia stabilnych zasob√≥w (ISS, Starlink, Tiangong) lub cel√≥w o wysokim znaczeniu poprzez prostƒÖ zmianƒô identyfikatora w konfiguracji.

üì∫ #YouTube:

CORE - https://youtu.be/lcWTPbxM3_g

REPLAY - https://youtu.be/nNv6e3a4rn4

üåê Socials:

Linkedin: https://www.linkedin.com/posts/lukebluelox_deorbitacja-zq3-blox-share-7423271298686173184-G4w8

ùïè: https://x.com/LukeStriderGM/status/2017505668349968509

</details>

---

## üá∫üá∏ Core Features

* **Universal Architecture**: Compatible with the entire NORAD database. Whether it's a falling rocket body or the ISS, if it has an ID, this tool can track it.
* **Real-Time Telemetry Bridge**: Fetches precise orbital data (Latitude, Longitude, Altitude) every second and injects it into the TAK network.
* **Native CoT Transformation**: Instantly converts API data into XML-based Cursor on Target (CoT) events compatible with TAK Servers (CivTAK/FreeTAKServer) and ATAK Civ/Mil clients.
* **Dynamic Hostility Tagging**: Configurable tagging system to flag objects as "Hostile" (Imminent Threat/Debris) or "Friendly/Neutral" (Active Assets).
* **Mission Replay Module**: Includes a dedicated `replay_cot.py` engine to re-broadcast captured log data for post-mission analysis, training, and simulation.
* **Secure SSL/TLS Transmission**: Supports encrypted communication channels for professional deployments.
* **Bilingual Logs**: Console outputs and system logs are formatted in a clean, vertical bilingual style (English/Polish) for international collaboration.

<details>

<summary>üáµüá±</summary>

## üáµüá± G≈Ç√≥wne Funkcjonalno≈õci

* **Uniwersalna Architektura**: Kompatybilno≈õƒá z ca≈ÇƒÖ bazƒÖ danych NORAD. Niezale≈ºnie od tego, czy jest to spadajƒÖcy cz≈Çon rakiety, czy ISS ‚Äì je≈õli obiekt ma ID, to narzƒôdzie mo≈ºe go ≈õledziƒá.
* **Most Telemetryczny w Czasie Rzeczywistym**: Pobiera precyzyjne dane orbitalne (Szeroko≈õƒá, D≈Çugo≈õƒá, Wysoko≈õƒá) co sekundƒô i wstrzykuje je do sieci TAK.
* **Natywna Transformacja CoT**: Natychmiastowo konwertuje dane API na zdarzenia Cursor on Target (CoT) oparte na XML, kompatybilne z serwerami TAK (CivTAK/FreeTAKServer) i klientami ATAK Civ/Mil.
* **Dynamiczne Oznaczanie Wrogo≈õci**: Konfigurowalny system tagowania do oznaczania obiekt√≥w jako "Wrogie" (Bezpo≈õrednie Zagro≈ºenie/≈ömieci) lub "Przyjazne/Neutralne" (Aktywne Zasoby).
* **Modu≈Ç Odtwarzania Misji**: Zawiera dedykowany silnik `replay_cot.py` do ponownego nadawania przechwyconych danych log√≥w w celu analizy po misji, szkole≈Ñ i symulacji.
* **Bezpieczna Transmisja SSL/TLS**: Obs≈Çuguje szyfrowane kana≈Çy komunikacji dla profesjonalnych wdro≈ºe≈Ñ.
* **Dwujƒôzyczne Logi**: Wyj≈õcia konsoli i logi systemowe sƒÖ sformatowane w czystym, pionowym stylu dwujƒôzycznym (Angielski/Polski) dla wsp√≥≈Çpracy miƒôdzynarodowej.

</details>

---

## üá∫üá∏ Prerequisites

To deploy **BLOX-TAK-CoT**, you will need the following environment (optimized for Orange Pi 5 / Ubuntu / Debian):

1.  **Hardware**: Orange Pi 5 (or any Linux-based edge device/server).
2.  **OS**: Ubuntu 22.04 LTS or Debian Bookworm.
3.  **Python 3.10+**: With `venv` support.
4.  **Data Source**: A valid API key from [n2yo.com](https://www.n2yo.com/api/).
5.  **Target System**: A running TAK Server instance reachable via IP.
6.  **Security**: Valid client certificates (`.pem`, `.key`, `trusted-root.pem`) for the TAK connection.

<details>

<summary>üáµüá±</summary>

## üáµüá± Wymagania Wstƒôpne

Aby wdro≈ºyƒá **BLOX-TAK-CoT**, bƒôdziesz potrzebowaƒá nastƒôpujƒÖcego ≈õrodowiska (zoptymalizowanego dla Orange Pi 5 / Ubuntu / Debian):

1.  **Sprzƒôt**: Orange Pi 5 (lub dowolne urzƒÖdzenie brzegowe/serwer oparty na Linuxie).
2.  **System Operacyjny**: Ubuntu 22.04 LTS lub Debian Bookworm.
3.  **Python 3.10+**: Z obs≈ÇugƒÖ `venv`.
4.  **≈πr√≥d≈Ço Danych**: Wa≈ºny klucz API ze strony [n2yo.com](https://www.n2yo.com/api/).
5.  **System Docelowy**: Dzia≈ÇajƒÖca instancja serwera TAK dostƒôpna przez IP.
6.  **Bezpiecze≈Ñstwo**: Wa≈ºne certyfikaty klienta (`.pem`, `.key`, `trusted-root.pem`) do po≈ÇƒÖczenia TAK.

</details>

---

## üá∫üá∏ Installation Guide / üáµüá± Instrukcja Instalacji

Follow these steps to set up the **BLOX-TAK-CoT** environment.

### üá∫üá∏ Step 1: Clone & Configure Environment

1.  **Clone the Repository**:
    ```bash
    git clone https://github.com/LukeStriderGM/BLOX-TAK-CoT
    cd BLOX-TAK-CoT
    ```

2.  **Create Virtual Environment**:
    It is crucial to use a virtual environment to manage dependencies properly without affecting the system root.
    ```bash
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Install Requirements**:
    ```bash
    pip install -r requirements.txt
    ```
    https://pypi.org/project/PyCoT

<details>

<summary>üáµüá±</summary>

### üáµüá± Krok 1: Klonowanie i Konfiguracja ≈örodowiska

1.  **Sklonuj Repozytorium**:
    ```bash
    git clone https://github.com/LukeStriderGM/BLOX-TAK-CoT
    cd BLOX-TAK-CoT
    ```

2.  **Utw√≥rz Wirtualne ≈örodowisko**:
    U≈ºycie wirtualnego ≈õrodowiska jest kluczowe dla poprawnego zarzƒÖdzania zale≈ºno≈õciami bez wp≈Çywu na system g≈Ç√≥wny (root).
    ```bash
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Zainstaluj Wymagania**:
    ```bash
    pip install -r requirements.txt
    ```
    https://pypi.org/project/PyCoT

</details>

---

## üá∫üá∏ Configuration / üáµüá± Konfiguracja

The system is designed to be easily reconfigurable for different missions. Edit the top section of `N2YO-API-Query_PyCoT-TAK-Server.py`.

### üá∫üá∏ Target Selection
Modify the `SAT_ID` variable to track different objects.

```python
# --- USER SETTINGS ---
N2YO_API_KEY = "YOUR-API-KEY"

# Target Definition (NORAD ID)
SAT_ID = 66877      # Target: ZQ-3 R/B (Debris/Reentry)
# SAT_ID = 25544    # Target: ISS (International Space Station)
# SAT_ID = 48274    # Target: CSS (Tiangong Space Station)
```

### üá∫üá∏ Tactical Identity (Hostility)

Adjust the CoT type to reflect the tactical nature of the object.

https://github.com/wcrum/py-cot/blob/main/CoT/types.py

```python
# For Threats / Debris / Hostiles:
type="a-h-P-S"  # Atom-Hostile-Space-Satellite (Red Icon)

# For Friendly / Neutral Assets:
type="a-n-P-S"  # Atom-Neutral-Space-Satellite (Green/Blue Icon)
```

<details>

<summary>üáµüá±</summary>

### üáµüá± Wyb√≥r Celu

Zmodyfikuj zmiennƒÖ `SAT_ID`, aby ≈õledziƒá r√≥≈ºne obiekty.

```python
# --- USTAWIENIA U≈ªYTKOWNIKA ---
N2YO_API_KEY = "TW√ìJ-KLUCZ-API"

# Definicja Celu (NORAD ID)
SAT_ID = 66877      # Cel: ZQ-3 R/B (SzczƒÖtki/Deorbitacja)
# SAT_ID = 25544    # Cel: ISS (Miƒôdzynarodowa Stacja Kosmiczna)
# SAT_ID = 48274    # Cel: CSS (Stacja Kosmiczna Tiangong)
```

### üáµüá± To≈ºsamo≈õƒá Taktyczna (Wrogo≈õƒá)

Dostosuj `type` CoT, aby odzwierciedliƒá taktycznƒÖ naturƒô obiektu.

https://github.com/wcrum/py-cot/blob/main/CoT/types.py

```python
# Dla Zagro≈ºe≈Ñ / SzczƒÖtk√≥w / Wrog√≥w:
type="a-h-P-S"  # Atom-Hostile-Space-Satellite (Czerwona Ikona)

# Dla Zasob√≥w Przyjaznych / Neutralnych:
type="a-n-P-S"  # Atom-Neutral-Space-Satellite (Zielona/Niebieska Ikona)
```

</details>

---

## üá∫üá∏ Usage / üáµüá± U≈ºycie

### üá∫üá∏ Mode 1: Real-Time Tracker

Starts the live bridge between N2YO and the TAK Server. Note: Use `sudo` combined with the `venv` path to ensure access to SSL certs and system sockets.

```bash
sudo ./.venv/bin/python3 N2YO-API-Query_PyCoT-TAK-Server.py
```

*   **Output**: Displays live formatted ALT/LAT/LON telemetry.
*   **Logging**: Automatically saves session data to `cot.log`.

### üá∫üá∏ Mode 2: Mission Replay

Re-broadcasts captured telemetry to simulate the event or analyze data post-mission.

```bash
sudo ./.venv/bin/python3 replay_cot.py
```

*   The script prompts for Start/End Time (Format: `YYYY-MM-DD HH:MM:SS`).
*   Reads from `cot.log` and injects packets into the TAK network as if they were live.

<details>

<summary>üáµüá±</summary>

### üáµüá± Tryb 1: Tracker Czasu Rzeczywistego

Uruchamia ≈ºywy most miƒôdzy N2YO a serwerem TAK. Uwaga: U≈ºyj `sudo` w po≈ÇƒÖczeniu ze ≈õcie≈ºkƒÖ `venv`, aby zapewniƒá dostƒôp do certyfikat√≥w SSL i gniazd systemowych.

```bash
sudo ./.venv/bin/python3 N2YO-API-Query_PyCoT-TAK-Server.py
```

*   **Wyj≈õcie**: Wy≈õwietla sformatowanƒÖ telemetriƒô WYS/SZER/D≈ÅU na ≈ºywo.
*   **Logowanie**: Automatycznie zapisuje dane sesji do `cot.log`.

### üáµüá± Tryb 2: Odtwarzanie Misji (Replay)

Ponownie nadaje przechwyconƒÖ telemetriƒô w celu symulacji zdarzenia lub analizy danych po misji.

```bash
sudo ./.venv/bin/python3 replay_cot.py
```

*   Skrypt prosi o Czas Startu/Ko≈Ñca (Format: `RRRR-MM-DD GG:MM:SS`).
*   Odczytuje dane z `cot.log` i wstrzykuje pakiety do sieci TAK tak, jakby by≈Çy na ≈ºywo.

</details>

---

## üá∫üá∏ License

This project is licensed under the MIT License. See the LICENSE file for details.

<details>

<summary>üáµüá±</summary>

## Licencja

Ten projekt jest objƒôty licencjƒÖ MIT. Zobacz plik LICENSE, aby uzyskaƒá szczeg√≥≈Çowe informacje.

T≈Çumaczenie [PL]:

Licencja MIT

Prawa autorskie (c) 2026 ≈Åukasz "LukeStriderGM" Andruszkiewicz

Niniejszym udziela siƒô bezp≈Çatnej zgody ka≈ºdej osobie wchodzƒÖcej w posiadanie kopii tego oprogramowania... (pe≈Çna tre≈õƒá w pliku LICENSE)

</details>

---

## üá∫üá∏ Code of Conduct

This project and everyone participating in it is governed by the Contributor Covenant. See the CODE_OF_CONDUCT.md file for details.

<details>

<summary>üáµüá±</summary>

## Kodeks Postƒôpowania - Contributor Covenant

Ten projekt i wszyscy w nim uczestniczƒÖcy podlegajƒÖ Zasadom Wsp√≥≈Çtw√≥rcy (Contributor Covenant). Zobacz plik CODE_OF_CONDUCT.md, aby uzyskaƒá szczeg√≥≈Çowe informacje.

(Pe≈Çne t≈Çumaczenie dostƒôpne w pliku CODE_OF_CONDUCT.md)

</details>

--- END FILE: README.md ---

--- START FILE: cot.log ---
2026-01-31 03:41:56,169 - INFO - CoT for ZQ-3 R/B: lat=55.56, lon=95.43, alt=64430.0
2026-01-31 03:42:06,724 - INFO - CoT for ZQ-3 R/B: lat=55.75, lon=96.59, alt=64360.0
2026-01-31 03:42:17,442 - INFO - CoT for ZQ-3 R/B: lat=55.94, lon=97.86, alt=64270.0
2026-01-31 03:42:27,945 - INFO - CoT for ZQ-3 R/B: lat=56.10, lon=99.04, alt=64200.0
2026-01-31 03:42:38,655 - INFO - CoT for ZQ-3 R/B: lat=56.27, lon=100.34, alt=64110.0
2026-01-31 03:42:49,243 - INFO - CoT for ZQ-3 R/B: lat=56.42, lon=101.66, alt=64020.0
2026-01-31 03:42:59,964 - INFO - CoT for ZQ-3 R/B: lat=56.54, lon=102.86, alt=63940.0
2026-01-31 03:43:10,523 - INFO - CoT for ZQ-3 R/B: lat=56.66, lon=104.19, alt=63850.0
2026-01-31 03:43:21,127 - INFO - CoT for ZQ-3 R/B: lat=56.77, lon=105.53, alt=63750.0
2026-01-31 03:43:31,724 - INFO - CoT for ZQ-3 R/B: lat=56.85, lon=106.76, alt=63660.0
2026-01-31 03:43:42,362 - INFO - CoT for ZQ-3 R/B: lat=56.93, lon=108.11, alt=63560.0
2026-01-31 03:43:52,899 - INFO - CoT for ZQ-3 R/B: lat=56.99, lon=109.35, alt=63470.0
2026-01-31 03:44:03,416 - INFO - CoT for ZQ-3 R/B: lat=57.03, lon=110.71, alt=63360.0
2026-01-31 03:44:13,992 - INFO - CoT for ZQ-3 R/B: lat=57.06, lon=111.95, alt=63270.0
2026-01-31 03:44:24,572 - INFO - CoT for ZQ-3 R/B: lat=57.08, lon=113.32, alt=63160.0
2026-01-31 03:44:35,077 - INFO - CoT for ZQ-3 R/B: lat=57.08, lon=114.57, alt=63060.0
2026-01-31 03:44:45,640 - INFO - CoT for ZQ-3 R/B: lat=57.07, lon=115.94, alt=62940.0
2026-01-31 03:44:56,375 - INFO - CoT for ZQ-3 R/B: lat=57.04, lon=117.30, alt=62820.0
2026-01-31 03:45:07,087 - INFO - CoT for ZQ-3 R/B: lat=57.00, lon=118.54, alt=62720.0
2026-01-31 03:45:17,745 - INFO - CoT for ZQ-3 R/B: lat=56.94, lon=119.90, alt=62600.0
2026-01-31 03:45:28,231 - INFO - CoT for ZQ-3 R/B: lat=56.86, lon=121.26, alt=62470.0
2026-01-31 03:45:38,743 - INFO - CoT for ZQ-3 R/B: lat=56.78, lon=122.48, alt=62360.0
2026-01-31 03:45:49,282 - INFO - CoT for ZQ-3 R/B: lat=56.67, lon=123.83, alt=62230.0
2026-01-31 03:45:59,836 - INFO - CoT for ZQ-3 R/B: lat=56.56, lon=125.04, alt=62110.0
2026-01-31 03:46:10,418 - INFO - CoT for ZQ-3 R/B: lat=56.43, lon=126.37, alt=61980.0
2026-01-31 03:46:20,991 - INFO - CoT for ZQ-3 R/B: lat=56.29, lon=127.56, alt=61860.0
2026-01-31 03:46:31,515 - INFO - CoT for ZQ-3 R/B: lat=56.13, lon=128.87, alt=61730.0
2026-01-31 03:46:42,028 - INFO - CoT for ZQ-3 R/B: lat=55.97, lon=130.04, alt=61600.0
2026-01-31 03:46:52,576 - INFO - CoT for ZQ-3 R/B: lat=55.78, lon=131.33, alt=61460.0
2026-01-31 03:47:03,171 - INFO - CoT for ZQ-3 R/B: lat=55.57, lon=132.60, alt=61320.0
2026-01-31 03:47:13,816 - INFO - CoT for ZQ-3 R/B: lat=55.37, lon=133.74, alt=61190.0
2026-01-31 03:47:24,526 - INFO - CoT for ZQ-3 R/B: lat=55.14, lon=134.98, alt=61050.0
2026-01-31 03:47:35,126 - INFO - CoT for ZQ-3 R/B: lat=54.90, lon=136.21, alt=60900.0
2026-01-31 03:47:45,687 - INFO - CoT for ZQ-3 R/B: lat=54.66, lon=137.31, alt=60770.0
2026-01-31 03:47:56,233 - INFO - CoT for ZQ-3 R/B: lat=54.39, lon=138.50, alt=60620.0
2026-01-31 03:48:06,804 - INFO - CoT for ZQ-3 R/B: lat=54.13, lon=139.58, alt=60480.0
2026-01-31 03:48:17,299 - INFO - CoT for ZQ-3 R/B: lat=53.84, lon=140.74, alt=60330.0

--- END FILE: cot.log ---

--- START FILE: cot_replay.log ---
2026-01-31 03:41:56,169 - INFO - CoT for ZQ-3 R/B: lat=55.56, lon=95.43, alt=64430.0
2026-01-31 03:42:06,724 - INFO - CoT for ZQ-3 R/B: lat=55.75, lon=96.59, alt=64360.0
2026-01-31 03:42:17,442 - INFO - CoT for ZQ-3 R/B: lat=55.94, lon=97.86, alt=64270.0
2026-01-31 03:42:27,945 - INFO - CoT for ZQ-3 R/B: lat=56.10, lon=99.04, alt=64200.0
2026-01-31 03:42:38,655 - INFO - CoT for ZQ-3 R/B: lat=56.27, lon=100.34, alt=64110.0
2026-01-31 03:42:49,243 - INFO - CoT for ZQ-3 R/B: lat=56.42, lon=101.66, alt=64020.0
2026-01-31 03:42:59,964 - INFO - CoT for ZQ-3 R/B: lat=56.54, lon=102.86, alt=63940.0
2026-01-31 03:43:10,523 - INFO - CoT for ZQ-3 R/B: lat=56.66, lon=104.19, alt=63850.0
2026-01-31 03:43:21,127 - INFO - CoT for ZQ-3 R/B: lat=56.77, lon=105.53, alt=63750.0
2026-01-31 03:43:31,724 - INFO - CoT for ZQ-3 R/B: lat=56.85, lon=106.76, alt=63660.0
2026-01-31 03:43:42,362 - INFO - CoT for ZQ-3 R/B: lat=56.93, lon=108.11, alt=63560.0
2026-01-31 03:43:52,899 - INFO - CoT for ZQ-3 R/B: lat=56.99, lon=109.35, alt=63470.0
2026-01-31 03:44:03,416 - INFO - CoT for ZQ-3 R/B: lat=57.03, lon=110.71, alt=63360.0
2026-01-31 03:44:13,992 - INFO - CoT for ZQ-3 R/B: lat=57.06, lon=111.95, alt=63270.0
2026-01-31 03:44:24,572 - INFO - CoT for ZQ-3 R/B: lat=57.08, lon=113.32, alt=63160.0
2026-01-31 03:44:35,077 - INFO - CoT for ZQ-3 R/B: lat=57.08, lon=114.57, alt=63060.0
2026-01-31 03:44:45,640 - INFO - CoT for ZQ-3 R/B: lat=57.07, lon=115.94, alt=62940.0
2026-01-31 03:44:56,375 - INFO - CoT for ZQ-3 R/B: lat=57.04, lon=117.30, alt=62820.0
2026-01-31 03:45:07,087 - INFO - CoT for ZQ-3 R/B: lat=57.00, lon=118.54, alt=62720.0
2026-01-31 03:45:17,745 - INFO - CoT for ZQ-3 R/B: lat=56.94, lon=119.90, alt=62600.0
2026-01-31 03:45:28,231 - INFO - CoT for ZQ-3 R/B: lat=56.86, lon=121.26, alt=62470.0
2026-01-31 03:45:38,743 - INFO - CoT for ZQ-3 R/B: lat=56.78, lon=122.48, alt=62360.0
2026-01-31 03:45:49,282 - INFO - CoT for ZQ-3 R/B: lat=56.67, lon=123.83, alt=62230.0
2026-01-31 03:45:59,836 - INFO - CoT for ZQ-3 R/B: lat=56.56, lon=125.04, alt=62110.0
2026-01-31 03:46:10,418 - INFO - CoT for ZQ-3 R/B: lat=56.43, lon=126.37, alt=61980.0
2026-01-31 03:46:20,991 - INFO - CoT for ZQ-3 R/B: lat=56.29, lon=127.56, alt=61860.0
2026-01-31 03:46:31,515 - INFO - CoT for ZQ-3 R/B: lat=56.13, lon=128.87, alt=61730.0
2026-01-31 03:46:42,028 - INFO - CoT for ZQ-3 R/B: lat=55.97, lon=130.04, alt=61600.0
2026-01-31 03:46:52,576 - INFO - CoT for ZQ-3 R/B: lat=55.78, lon=131.33, alt=61460.0
2026-01-31 03:47:03,171 - INFO - CoT for ZQ-3 R/B: lat=55.57, lon=132.60, alt=61320.0
2026-01-31 03:47:13,816 - INFO - CoT for ZQ-3 R/B: lat=55.37, lon=133.74, alt=61190.0
2026-01-31 03:47:24,526 - INFO - CoT for ZQ-3 R/B: lat=55.14, lon=134.98, alt=61050.0
2026-01-31 03:47:35,126 - INFO - CoT for ZQ-3 R/B: lat=54.90, lon=136.21, alt=60900.0
2026-01-31 03:47:45,687 - INFO - CoT for ZQ-3 R/B: lat=54.66, lon=137.31, alt=60770.0
2026-01-31 03:47:56,233 - INFO - CoT for ZQ-3 R/B: lat=54.39, lon=138.50, alt=60620.0
2026-01-31 03:48:06,804 - INFO - CoT for ZQ-3 R/B: lat=54.13, lon=139.58, alt=60480.0
2026-01-31 03:48:17,299 - INFO - CoT for ZQ-3 R/B: lat=53.84, lon=140.74, alt=60330.0

--- END FILE: cot_replay.log ---

--- START FILE: replay_cot.py ---
import CoT  # https://pypi.org/project/PyCoT
import socket
import ssl
import os
import logging
import datetime
import time
import re
import warnings
from dateutil.parser import parse as parse_date

# --- CONFIGURATION OF WARNINGS ---
# --- KONFIGURACJA OSTRZE≈ªE≈É ---

# Disable annoying library warnings
# Wy≈ÇƒÖcz irytujƒÖce ostrze≈ºenia biblioteki
warnings.filterwarnings("ignore")

# --- LOGGING CONFIGURATION ---
# --- KONFIGURACJA LOGOWANIA ---

# Configure logging for the replayer itself
# Konfiguracja logowania dla samego odtwarzacza
logging.basicConfig(
    filename="cot_replay.log",
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s"
)

# --- TAK SERVER SETTINGS ---
# --- USTAWIENIA SERWERA TAK ---

# IP address and port (Matches your main script)
# Adres IP i port (Zgodne z g≈Ç√≥wnym skryptem)
TAK_IP = "192.168.1.2"
TAK_PORT = 8089

# --- SSL CERTIFICATES ---
# --- CERTYFIKATY SSL ---

# Define paths to certificates (OrangePi Paths)
# Zdefiniuj ≈õcie≈ºki do certyfikat√≥w (≈öcie≈ºki OrangePi)
CERT_DIR = "/home/lukestridergm/BLOX-TAK-CoT/certs"
CLIENT_CERT = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN.pem")
CLIENT_KEY = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN.key")
CA_CERT = os.path.join(CERT_DIR, "BLOX-TAK-SF-ADMIN-trusted.pem")

# --- SSL CONTEXT PREPARATION ---
# --- PRZYGOTOWANIE KONTEKSTU SSL ---

# Load client and CA certificates
# Za≈Çaduj certyfikaty klienta i CA
ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
ssl_context.load_cert_chain(certfile=CLIENT_CERT, keyfile=CLIENT_KEY)
ssl_context.load_verify_locations(cafile=CA_CERT)
ssl_context.verify_mode = ssl.CERT_REQUIRED

# --- REPLAY SETTINGS ---
# --- USTAWIENIA ODTWARZANIA ---

# Path to the input log file (Where the main script writes)
# ≈öcie≈ºka do pliku log√≥w wej≈õciowych (Gdzie zapisuje g≈Ç√≥wny skrypt)
LOG_FILE = "/home/lukestridergm/BLOX-TAK-CoT/cot.log"

# Target Identity for Replay
# To≈ºsamo≈õƒá celu dla odtwarzania
SAT_ID = 66877  # ZQ-3 R/B
SAT_NAME = "ZQ-3 R/B (REPLAY)"
REFRESH_INTERVAL = 1.0  # Speed of replay (1.0 = Realtime)


def parse_log_for_positions(start_time, end_time):
    """
    Parse the log file for CoT position entries within the given time range.
    Parsuj plik log√≥w w poszukiwaniu pozycji CoT w zadanym zakresie czasu.
    """
    positions = []

    # Regex matching the FIXED logging format: "lat=50.1 lon=15.2 alt=60000.0"
    # Regex pasujƒÖcy do NAPRAWIONEGO formatu logowania
    regex_standard = re.compile(
        r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d{3}).*lat=(-?\d+\.\d+).*lon=(-?\d+\.\d+).*alt=(-?\d+\.?\d*)"
    )

    try:
        with open(LOG_FILE, "r") as file:
            for line in file:
                match = regex_standard.search(line)
                if match:
                    timestamp_str, lat, lon, alt = match.groups()
                    try:
                        timestamp = parse_date(timestamp_str)
                        # Filter by time range
                        if start_time <= timestamp <= end_time:
                            positions.append((timestamp, float(lat), float(lon), float(alt)))
                    except Exception:
                        continue
    except FileNotFoundError:
        print(f"‚ùå Error: Log file not found: {LOG_FILE}")
        print(f"‚ùå B≈ÇƒÖd: Nie znaleziono pliku log√≥w: {LOG_FILE}")
        return []
    except Exception as e:
        print(f"‚ùå Error parsing log file: {e}")
        print(f"‚ùå B≈ÇƒÖd parsowania pliku log√≥w: {e}")
        return []

    return positions


def send_cot_to_tak(lat, lon, alt, timestamp):
    """
    Send a CoT message to the TAK server via SSL.
    Wy≈õlij wiadomo≈õƒá CoT do serwera TAK przez SSL.
    """
    try:
        # Establish SSL connection
        # NawiƒÖ≈º po≈ÇƒÖczenie SSL
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        wrapped_sock = ssl_context.wrap_socket(sock, server_hostname=TAK_IP)
        wrapped_sock.connect((TAK_IP, TAK_PORT))
        wrapped_sock.settimeout(2.0)

        # Create CoT event
        # Stw√≥rz zdarzenie CoT

        # CoT types: https://github.com/wcrum/py-cot/blob/main/CoT/types.py
        stale = timestamp + datetime.timedelta(minutes=5)
        cot_event = CoT.Event(
            version="2.0",
            type="a-h-P-S",  # Hostile Space Satellite
            uid=f"SAT.{SAT_ID}.REPLAY",  # Unique ID for replay so it doesn't conflict
            time=timestamp,
            start=timestamp,
            stale=stale,
            how="m-g",
            point=CoT.Point(
                lat=lat,
                lon=lon,
                hae=alt,
                ce=9999999,
                le=9999999
            ),
            detail={
                "contact": {"callsign": SAT_NAME},
                "remarks": "REPLAY MODE - SIMULATION"
            }
        )

        # Send CoT message
        # Wy≈õlij wiadomo≈õƒá CoT
        wrapped_sock.sendall(bytes(cot_event.xml(), encoding="utf-8"))

        # Log and print position (IDENTICAL FORMAT TO MAIN SCRIPT)
        # Loguj i wypisz pozycjƒô (FORMAT IDENTYCZNY JAK W G≈Å√ìWNYM SKRYPCIE)
        print(
            f"üì° REPLAY: {timestamp.strftime('%H:%M:%S')} | ALT: {alt:>8.0f} m | LAT: {lat:>7.2f} | LON: {lon:>8.2f} | üî¥ HOSTILE")
        print(
            f"üì° ODTW.:  {timestamp.strftime('%H:%M:%S')} | WYS: {alt:>8.0f} m | SZER:{lat:>7.2f} | D≈ÅU: {lon:>8.2f} | üî¥ WROGI")

        logging.info(f"Replayed CoT: lat={lat}, lon={lon}, alt={alt}")

        # Clear buffer (Receive confirmation)
        # Wyczy≈õƒá bufor (Odbierz potwierdzenie)
        try:
            _ = wrapped_sock.recv(1024)
        except socket.timeout:
            pass

        wrapped_sock.close()
        return True

    except (ConnectionRefusedError, ssl.SSLError) as e:
        print(f"‚ùå SSL Error: {e}")
        return False
    except Exception as e:
        print(f"‚ùå Error: {e}")
        return False


def main():
    # User Interface
    # Interfejs U≈ºytkownika
    print(f"üéûÔ∏è  CoT REPLAYER STARTING")
    print(f"üéûÔ∏è  URUCHAMIANIE ODTWARZACZA CoT")
    print(f"üìÇ Reading from: {LOG_FILE}")
    print(f"üìÇ Odczyt z: {LOG_FILE}")
    print("-" * 40)

    print("Enter time range (YYYY-MM-DD HH:MM:SS)")
    print("Wprowad≈∫ zakres czasu (RRRR-MM-DD GG:MM:SS)")
    print("Example/Przyk≈Çad: 2026-01-31 03:41:00")

    try:
        start_time_str = input("Start: ")
        end_time_str = input("End/Koniec: ")

        start_time = parse_date(start_time_str)
        end_time = parse_date(end_time_str)

        if start_time >= end_time:
            print("‚ùå Start time must be before end time.")
            return

        # Parse log file
        # Parsuj plik log√≥w
        print(f"üîÑ Scanning log file...")
        positions = parse_log_for_positions(start_time, end_time)

        if not positions:
            print("‚ö†Ô∏è No positions found. Check if cot.log has data with 'lat=' and 'lon='.")
            print("‚ö†Ô∏è Nie znaleziono pozycji. Sprawd≈∫ czy cot.log ma dane z 'lat=' i 'lon='.")
            return

        print(f"‚úÖ Found {len(positions)} frames. Starting Replay...")
        time.sleep(1)

        # Replay Loop
        # Pƒôtla Odtwarzania
        for timestamp, lat, lon, alt in positions:
            if send_cot_to_tak(lat, lon, alt, timestamp):
                time.sleep(REFRESH_INTERVAL)
            else:
                print("‚ö†Ô∏è Skipped frame.")

    except ValueError as e:
        print(f"‚ùå Invalid date format: {e}")
    except Exception as e:
        print(f"‚ùå Critical Error: {e}")


if __name__ == "__main__":
    main()
--- END FILE: replay_cot.py ---

--- START FILE: requirements.txt ---
requests
PyCoT
python-dateutil
--- END FILE: requirements.txt ---
